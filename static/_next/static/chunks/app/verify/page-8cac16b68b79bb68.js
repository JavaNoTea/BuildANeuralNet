(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[434],{397:(e,t,r)=>{"use strict";r.d(t,{v:()=>l});var s=r(6636);let a=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,n={setState:s,getState:a,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e))},o=t=e(s,a,n);return n},n=e=>e?a(e):a,o=e=>e,i=e=>{let t=n(e),r=e=>(function(e,t=o){let r=s.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},l=e=>e?i(e):i},2323:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var s=r(397),a=r(7287);let n=(0,s.v)()((0,a.Zr)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,setAuth:(t,r,s)=>e({user:t,accessToken:r,refreshToken:s,isAuthenticated:!0}),setTokens:(t,r)=>e({accessToken:t,refreshToken:r}),logout:()=>e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1}),updateTokens:(t,r)=>e({accessToken:t,refreshToken:r}),setLoading:t=>e({isLoading:t})}),{name:"auth-storage",partialize:e=>({accessToken:e.accessToken,refreshToken:e.refreshToken})}))},6153:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(6384),a=r(6636),n=r(3066),o=r(7039);function i(){let e=(0,n.useSearchParams)(),t=(0,n.useRouter)(),[r,i]=(0,a.useState)("verifying"),[l,c]=(0,a.useState)("");return(0,a.useEffect)(()=>{let r=e.get("token");if(!r){i("error"),c("No verification token provided");return}(async()=>{try{await o.FH.verifyEmail(r),i("success"),c("Email verified successfully! You can now log in."),setTimeout(()=>{t.push("/")},3e3)}catch(e){i("error"),c(e.detail||"Verification failed. The link may be invalid or expired.")}})()},[e,t]),(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:["verifying"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Verifying Email"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Please wait while we verify your email address..."})]}),"success"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-green-500 mb-4",children:(0,s.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Email Verified!"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:l}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Redirecting to home page..."})]}),"error"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-red-500 mb-4",children:(0,s.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Verification Failed"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:l}),(0,s.jsx)("button",{onClick:()=>t.push("/"),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Go to Home"})]})]})})}function l(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Loading"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Please wait..."})]})}),children:(0,s.jsx)(i,{})})}},7039:(e,t,r)=>{"use strict";r.d(t,{FH:()=>l});var s=r(2323);let a=r(7946).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";class n{static sanitizeInput(e){if("string"==typeof e)return e.replace(/[<>'"]/g,"").trim().slice(0,1e4);if(Array.isArray(e))return e.map(e=>n.sanitizeInput(e));if("object"==typeof e&&null!==e){let t={};for(let[r,s]of Object.entries(e))/^[a-zA-Z0-9_-]+$/.test(r)&&(t[r]=n.sanitizeInput(s));return t}return e}static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<=255}static validatePassword(e){let t=[];return e.length<8&&t.push("Password must be at least 8 characters long"),/[A-Z]/.test(e)||t.push("Password must contain at least one uppercase letter"),/[a-z]/.test(e)||t.push("Password must contain at least one lowercase letter"),/\d/.test(e)||t.push("Password must contain at least one number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||t.push("Password must contain at least one special character"),{isValid:0===t.length,errors:t}}static generateCSRFToken(){let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}static isValidContentType(e){return["application/json","text/plain","multipart/form-data"].some(t=>e.includes(t))}}class o{async checkRateLimit(){let e=Date.now();if(e-this.state.windowStart>=this.windowMs&&(this.state.windowStart=e,this.state.requestCount=0),this.state.requestCount>=this.maxRequests){let t=this.windowMs-(e-this.state.windowStart);throw Error("Rate limit exceeded. Please wait ".concat(Math.ceil(t/1e3)," seconds."))}let t=e-this.state.lastRequest;t<1e3&&await new Promise(e=>setTimeout(e,1e3-t)),this.state.requestCount++,this.state.lastRequest=e}constructor(){this.state={lastRequest:0,requestCount:0,windowStart:Date.now()},this.maxRequests=60,this.windowMs=6e4}}class i{async refreshTokens(){let{refreshToken:e,updateTokens:t,logout:r}=s.n.getState();if(!e)return console.log("No refresh token available"),!1;console.log("Attempting to refresh tokens...");try{let s=await fetch("".concat(this.baseURL,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.csrfToken},body:JSON.stringify({refresh_token:e})});if(console.log("Token refresh response:",s.status,s.statusText),s.ok){let e=s.headers.get("content-type")||"";if(!n.isValidContentType(e))return console.error("Invalid content type in refresh response"),!1;let r=await s.json();return console.log("Token refresh successful, updating tokens"),t(r.access_token,r.refresh_token),!0}{console.log("Token refresh failed with status:",s.status);let e=await s.json().catch(()=>({}));console.log("Token refresh error details:",e),r()}}catch(e){console.error("Token refresh failed:",e),r()}return!1}async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await this.rateLimiter.checkRateLimit();let{accessToken:a,logout:o}=s.n.getState(),i=new Headers(t.headers);i.set("Content-Type","application/json"),i.set("X-CSRF-Token",this.csrfToken),i.set("X-Requested-With","XMLHttpRequest"),a?(i.set("Authorization","Bearer ".concat(a)),console.log("Making request to ".concat(e," with token:"),a.substring(0,20)+"...")):console.log("Making request to ".concat(e," without token"));let l=new AbortController,c=setTimeout(()=>l.abort(),1e4);try{let s=await fetch("".concat(this.baseURL).concat(e),{...t,headers:i,signal:l.signal,credentials:this.baseURL.includes(window.location.hostname)?"include":"omit"});clearTimeout(c),console.log("Response from ".concat(e,":"),s.status,s.statusText);let d=s.headers.get("content-type")||"";if(s.ok&&!n.isValidContentType(d))throw Error("Invalid response content type");if(401===s.status&&!r&&a){if(console.log("401 error detected, attempting token refresh..."),await this.refreshTokens())return console.log("Token refresh successful, retrying request..."),this.makeRequest(e,t,!0);console.log("Token refresh failed, logging out..."),o()}return s}catch(t){if(clearTimeout(c),t instanceof Error&&"AbortError"===t.name)throw console.log("Request to ".concat(e," timed out after ").concat(1e4,"ms")),Error("Request timeout: ".concat(e));throw console.log("Request to ".concat(e," failed:"),t),t}}async get(e){let t=await this.makeRequest(e);if(!t.ok)throw await this.handleError(t);return t.json()}async post(e,t){let r=t?n.sanitizeInput(t):void 0,s=await this.makeRequest(e,{method:"POST",body:r?JSON.stringify(r):void 0});if(!s.ok)throw await this.handleError(s);return s.json()}async put(e,t){let r=t?n.sanitizeInput(t):void 0,s=await this.makeRequest(e,{method:"PUT",body:r?JSON.stringify(r):void 0});if(!s.ok)throw await this.handleError(s);return s.json()}async delete(e){let t=await this.makeRequest(e,{method:"DELETE"});if(!t.ok)throw await this.handleError(t);return t.json()}async handleError(e){let t="An error occurred";try{let r=e.headers.get("content-type")||"";if(n.isValidContentType(r)){let r=await e.json();t=r.detail||r.message||t}}catch(r){t="HTTP ".concat(e.status,": ").concat(e.statusText)}return{detail:t,status:e.status}}async login(e,t){if(!n.isValidEmail(e))throw Error("Invalid email format");if(!t||t.length<8)throw Error("Invalid password");let r=new FormData;r.append("username",e),r.append("password",t);let s=new Headers;s.set("X-CSRF-Token",this.csrfToken),s.set("X-Requested-With","XMLHttpRequest");let a=await fetch("".concat(this.baseURL,"/auth/login"),{method:"POST",headers:s,body:r,credentials:"include"});if(!a.ok)throw await this.handleError(a);return a.json()}async register(e,t,r){if(!n.isValidEmail(e))throw Error("Invalid email format");if(!t||t.length<3||t.length>50)throw Error("Username must be between 3 and 50 characters");let s=n.validatePassword(r);if(!s.isValid)throw Error(s.errors.join("; "));let a={email:e.toLowerCase().trim(),username:t.trim(),password:r},o=await fetch("".concat(this.baseURL,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a),credentials:"include"});if(!o.ok)throw await this.handleError(o);return o.json()}async verifyEmail(e){if(!/^[A-Za-z0-9_-]+$/.test(e)||e.length<20)throw Error("Invalid verification token format");return this.post("/auth/verify-email",{token:e})}async getCurrentUser(){return this.get("/auth/me")}async createModel(e){if(!e.name||"string"!=typeof e.name)throw Error("Model name is required");if(e.name.length>255)throw Error("Model name too long");return this.post("/models",e)}async getModels(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e=Math.max(0,Math.min(e,1e4)),t=Math.max(1,Math.min(t,100)),this.get("/models?skip=".concat(e,"&limit=").concat(t))}async getModel(e){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))throw Error("Invalid model ID format");return this.get("/models/".concat(e))}async updateModel(e,t){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))throw Error("Invalid model ID format");return this.put("/models/".concat(e),t)}async deleteModel(e){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))throw Error("Invalid model ID format");return this.delete("/models/".concat(e))}async autosaveModel(e){return this.post("/models/autosave",e)}async generateCode(e){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))throw Error("Invalid model ID format");return this.post("/models/".concat(e,"/generate-code"),{})}constructor(e){this.baseURL=e,this.rateLimiter=new o,this.csrfToken=n.generateCSRFToken()}}let l=new i(a)},7287:(e,t,r)=>{"use strict";r.d(t,{Zr:()=>a});let s=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>s(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>s(t)(e)}}},a=(e,t)=>(r,a,n)=>{let o,i={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let s=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=r.getItem(e))?t:null;return a instanceof Promise?a.then(s):s(a)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},l=!1,c=new Set,d=new Set,u=i.storage;if(!u)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...e)},a,n);let h=()=>{let e=i.partialize({...a()});return u.setItem(i.name,{state:e,version:i.version})},m=n.setState;n.setState=(e,t)=>{m(e,t),h()};let f=e((...e)=>{r(...e),h()},a,n);n.getInitialState=()=>f;let g=()=>{var e,t;if(!u)return;l=!1,c.forEach(e=>{var t;return e(null!=(t=a())?t:f)});let n=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=a())?e:f))||void 0;return s(u.getItem.bind(u))(i.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];else{if(i.migrate){let t=i.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[s,n]=e;if(r(o=i.merge(n,null!=(t=a())?t:f),!0),s)return h()}).then(()=>{null==n||n(o,void 0),o=a(),l=!0,d.forEach(e=>e(o))}).catch(e=>{null==n||n(void 0,e)})};return n.persist={setOptions:e=>{i={...i,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>l,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},i.skipHydration||g(),o||f}},7831:(e,t,r)=>{Promise.resolve().then(r.bind(r,6153))}},e=>{var t=t=>e(e.s=t);e.O(0,[309,951,358],()=>t(7831)),_N_E=e.O()}]);